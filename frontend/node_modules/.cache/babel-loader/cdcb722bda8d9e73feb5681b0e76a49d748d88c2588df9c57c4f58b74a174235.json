{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Form,Button,Alert}from'react-bootstrap';import{useParams,useNavigate}from'react-router-dom';import api from'../../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function NovoEvento(){const{petId}=useParams();const navigate=useNavigate();const[pet,setPet]=useState(null);const[tipo,setTipo]=useState('Hospedagem');const[dataEntrada,setDataEntrada]=useState(new Date().toISOString().slice(0,16));const[dataSaida,setDataSaida]=useState('');const[observacoes,setObservacoes]=useState('');const[erro,setErro]=useState('');// Detecta perfil\nconst isTutor=!!localStorage.getItem('usuario_tutor');const isAdmin=!!localStorage.getItem('usuario_admin');// Função única de retorno\nconst goBack=()=>{if(isTutor)return navigate('/tutor/home');if(isAdmin)return navigate(`/pets/${petId}`);return navigate('/');};useEffect(()=>{if(!petId){setErro('ID do pet não foi fornecido.');return;}api.get(`/pets/${petId}`).then(_ref=>{let{data}=_ref;return setPet(data);}).catch(()=>setErro('Falha ao carregar dados do pet.'));},[petId]);const handleSubmit=async e=>{e.preventDefault();setErro('');if(!dataEntrada){setErro('Informe a data de entrada.');return;}try{await api.post('/eventos',{tipo,pet:petId,tutor:pet.tutor._id,dono:pet.dono._id,dataEntrada,...(dataSaida&&{dataSaida}),...(observacoes&&{observacoes})});goBack();}catch(err){var _err$response,_err$response$data,_err$response2,_err$response2$data;setErro(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.erro)||((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detalhes)||'Erro ao salvar evento.');}};if(erro){return/*#__PURE__*/_jsxs(Container,{className:\"mt-4\",children:[/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:erro}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:goBack,children:\"Voltar\"})]});}if(!pet){return/*#__PURE__*/_jsx(Container,{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Carregando pet...\"})});}return/*#__PURE__*/_jsxs(Container,{className:\"mt-4\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Cadastrar Evento para \",/*#__PURE__*/_jsx(\"strong\",{children:pet.nome})]}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,className:\"mt-3\",children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Tipo de Evento\"}),/*#__PURE__*/_jsx(Form.Select,{value:tipo,onChange:e=>setTipo(e.target.value),children:['Hospedagem','Passeio','Banho','Consulta','Alimentacao','Recreacao'].map(o=>/*#__PURE__*/_jsx(\"option\",{value:o,children:o},o))})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Data de Entrada\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",value:dataEntrada,onChange:e=>setDataEntrada(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(Form.Label,{children:[\"Data de Sa\\xEDda \",/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"(opcional)\"})]}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",value:dataSaida,onChange:e=>setDataSaida(e.target.value)})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(Form.Label,{children:[\"Observa\\xE7\\xF5es \",/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"(opcional)\"})]}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,value:observacoes,onChange:e=>setObservacoes(e.target.value),placeholder:\"Anota\\xE7\\xF5es adicionais...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",type:\"submit\",children:\"Salvar\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",className:\"ms-2\",onClick:goBack,children:\"Cancelar\"})]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","Container","Form","Button","Alert","useParams","useNavigate","api","jsx","_jsx","jsxs","_jsxs","NovoEvento","petId","navigate","pet","setPet","tipo","setTipo","dataEntrada","setDataEntrada","Date","toISOString","slice","dataSaida","setDataSaida","observacoes","setObservacoes","erro","setErro","isTutor","localStorage","getItem","isAdmin","goBack","get","then","_ref","data","catch","handleSubmit","e","preventDefault","post","tutor","_id","dono","err","_err$response","_err$response$data","_err$response2","_err$response2$data","response","detalhes","className","children","variant","onClick","nome","onSubmit","Group","Label","Select","value","onChange","target","map","o","Control","type","required","as","rows","placeholder"],"sources":["C:/Users/Ariel/PF2 - Walky-Loving-Dogs/frontend/src/pages/Evento/NovoEvento.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { Container, Form, Button, Alert } from 'react-bootstrap'\r\nimport { useParams, useNavigate } from 'react-router-dom'\r\nimport api from '../../services/api'\r\n\r\nexport default function NovoEvento() {\r\n  const { petId } = useParams()\r\n  const navigate = useNavigate()\r\n\r\n  const [pet, setPet] = useState(null)\r\n  const [tipo, setTipo] = useState('Hospedagem')\r\n  const [dataEntrada, setDataEntrada] = useState(new Date().toISOString().slice(0, 16))\r\n  const [dataSaida, setDataSaida] = useState('')\r\n  const [observacoes, setObservacoes] = useState('')\r\n  const [erro, setErro] = useState('')\r\n\r\n  // Detecta perfil\r\n  const isTutor = !!localStorage.getItem('usuario_tutor')\r\n  const isAdmin = !!localStorage.getItem('usuario_admin')\r\n\r\n  // Função única de retorno\r\n  const goBack = () => {\r\n    if (isTutor)  return navigate('/tutor/home')\r\n    if (isAdmin)  return navigate(`/pets/${petId}`)\r\n    return navigate('/')\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!petId) {\r\n      setErro('ID do pet não foi fornecido.')\r\n      return\r\n    }\r\n    api.get(`/pets/${petId}`)\r\n      .then(({ data }) => setPet(data))\r\n      .catch(() => setErro('Falha ao carregar dados do pet.'))\r\n  }, [petId])\r\n\r\n  const handleSubmit = async e => {\r\n    e.preventDefault()\r\n    setErro('')\r\n\r\n    if (!dataEntrada) {\r\n      setErro('Informe a data de entrada.')\r\n      return\r\n    }\r\n\r\n    try {\r\n      await api.post('/eventos', {\r\n        tipo,\r\n        pet: petId,\r\n        tutor: pet.tutor._id,\r\n        dono: pet.dono._id,\r\n        dataEntrada,\r\n        ...(dataSaida && { dataSaida }),\r\n        ...(observacoes && { observacoes }),\r\n      })\r\n\r\n      goBack()\r\n    } catch (err) {\r\n      setErro(\r\n        err.response?.data?.erro ||\r\n        err.response?.data?.detalhes ||\r\n        'Erro ao salvar evento.'\r\n      )\r\n    }\r\n  }\r\n\r\n  if (erro) {\r\n    return (\r\n      <Container className=\"mt-4\">\r\n        <Alert variant=\"danger\">{erro}</Alert>\r\n        <Button variant=\"secondary\" onClick={goBack}>Voltar</Button>\r\n      </Container>\r\n    )\r\n  }\r\n\r\n  if (!pet) {\r\n    return (\r\n      <Container className=\"mt-4\">\r\n        <p>Carregando pet...</p>\r\n      </Container>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Container className=\"mt-4\">\r\n      <h2>Cadastrar Evento para <strong>{pet.nome}</strong></h2>\r\n      <Form onSubmit={handleSubmit} className=\"mt-3\">\r\n        <Form.Group className=\"mb-3\">\r\n          <Form.Label>Tipo de Evento</Form.Label>\r\n          <Form.Select value={tipo} onChange={e => setTipo(e.target.value)}>\r\n            {['Hospedagem','Passeio','Banho','Consulta','Alimentacao','Recreacao']\r\n              .map(o => <option key={o} value={o}>{o}</option>)\r\n            }\r\n          </Form.Select>\r\n        </Form.Group>\r\n        <Form.Group className=\"mb-3\">\r\n          <Form.Label>Data de Entrada</Form.Label>\r\n          <Form.Control\r\n            type=\"datetime-local\"\r\n            value={dataEntrada}\r\n            onChange={e => setDataEntrada(e.target.value)}\r\n            required\r\n          />\r\n        </Form.Group>\r\n        <Form.Group className=\"mb-3\">\r\n          <Form.Label>Data de Saída <small className=\"text-muted\">(opcional)</small></Form.Label>\r\n          <Form.Control\r\n            type=\"datetime-local\"\r\n            value={dataSaida}\r\n            onChange={e => setDataSaida(e.target.value)}\r\n          />\r\n        </Form.Group>\r\n        <Form.Group className=\"mb-3\">\r\n          <Form.Label>Observações <small className=\"text-muted\">(opcional)</small></Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            rows={3}\r\n            value={observacoes}\r\n            onChange={e => setObservacoes(e.target.value)}\r\n            placeholder=\"Anotações adicionais...\"\r\n          />\r\n        </Form.Group>\r\n        <div className=\"d-flex\">\r\n          <Button variant=\"success\" type=\"submit\">Salvar</Button>\r\n          <Button variant=\"secondary\" className=\"ms-2\" onClick={goBack}>Cancelar</Button>\r\n        </div>\r\n      </Form>\r\n    </Container>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}